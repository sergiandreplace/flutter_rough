workflows:
  my-workflow:
    name: Release version
    environment:
      vars:
        CACHED_JSON: Encrypted(Z0FBQUFBQmVzSmM2bTRYMEJSWWhNNXhHWG10N2dyWmxacld6bHR6YzRhT3JMMkNqNTNTMWt5U2xjazQxUDc0Z1diNWJ1dlZ6eG5idVViaGRkc2tya25vOTROSF9yczhGX01vR3p2dnFySERsOGZGaExYYUlxVDZLaGtpUGQyVVlXUFoyeFFhaEdicl9aUGU4bW52eUNtRzVzeXphUUxTemxlT1I1LTk2VmhnUF9Udjg0NjZvLWllcm1fZUFCNUlTSy1iN2VYWm1lLXo0dmg1TEhvRHFJM3pvU29iT2hpVG5RR0lmNzRwTmQyQ3B5TXZLS1BCUHk3X1RGVkF4NllOVnBFSm5CRDdoMnhkaXAxNDZuM1E1ZTU5MFBrWHctSmRWQUxBT1pxQkdtSWxiS0xNdUY3YkQtUGZtcWo4QWFOU3M0aVYyZ0IyeUJQWkFfU2RTRjBRUHA4dmRFVGRib21JLU9YQm1BVTRsVWpSSVBnZzFtVEdsY0xQQ0dsYnRrZ0h0cHhxWmJDSWZDdzVV)
      flutter: stable
    cache:
      cache_paths:
        - ~/.pub-cache
    triggering:
      events:
        - tag
      branch_patterns:
        - pattern: 'test_codemagic'
          include: true
          source: true
    scripts:
      - flutter packages pub get
      - chmod +x ./scripts/cache.sh
      - ./scripts/cache.sh
      - flutter pub publish --dry-run
      - flutter pub publish -f
